
steps:
  - name: 'gcr.io/cloud-builders/mvn'
    entrypoint: 'bash'
    args:
      - '-c'
      - |
        echo "Running SonarQube analysis..."
        mvn sonar:sonar \
          -Dsonar.projectKey=my-service-dev \
          -Dsonar.host.url=https://sonarqube.mycompany.com \
          -Dsonar.login=$$TOKEN_SONRQUBE_GITOPS
    secretEnv: ['TOKEN_SONRQUBE_GITOPS']

availableSecrets:
  secretManager:
    - versionName: projects/$PROJECT_ID/secrets/TOKEN_SONRQUBE_GITOPS/versions/latest
      env: 'TOKEN_SONRQUBE_GITOPS'
